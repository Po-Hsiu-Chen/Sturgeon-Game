System.register("chunks:///_virtual/Api.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,r;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){r=e.cclegacy}],execute:function(){function i(){return(i=n(t().mark((function e(n){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/auth/line",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:n})});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("auth/line failed");case 5:return e.abrupt("return",r.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e("authWithLine",(function(e){return i.apply(this,arguments)})),r._RF.push({},"60365l6LiVPNJDhC4p/FcIV","Api",void 0),r._RF.pop()}}}));

System.register("chunks:///_virtual/DataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./QuizData.ts"],(function(e){var t,r,n,a,s,u;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,r=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){a=e.cclegacy,s=e._decorator},function(e){u=e.quizQuestions}],execute:function(){a._RF.push({},"5f04d33bXZHvp95rX07ICDM","DataManager",void 0);s.ccclass,s.property;var i=e("DataManager",function(){function e(){}return e.onChange=function(e){var t=this;return this._listeners.add(e),function(){return t._listeners.delete(e)}},e._emit=function(e){for(var r,n=t(this._listeners);!(r=n()).done;){(0,r.value)(e)}},e.ensureInitialized=function(){var e=r(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setCurrentUser(t),e.next=3,this.getPlayerData(t);case 3:e.sent||console.error("[DataManager] 後端沒有這個玩家，請重新登入 LINE");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.setCurrentUser=function(e){this.currentUserId=e},e.init=function(){var e=r(n().mark((function e(t){var r,a=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ready||(this.ready=new Promise((function(e){return a.readyResolve=e}))),this.initializing=!0,this.setCurrentUser(t),e.next=5,this.ensureInitialized(t);case 5:this.initializing=!1,null==(r=this.readyResolve)||r.call(this);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.getPlayerData=function(){var e=r(n().mark((function e(t){var r,a,s,u,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ready||this.initializing){e.next=8;break}return e.prev=1,e.next=4,this.ready;case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:if(s="undefined"!=typeof window?localStorage.getItem("currentUserId"):null,u=(null!=(r=null!=(a=null!=t?t:this.currentUserId)?a:s)?r:"").trim()){e.next=13;break}return console.warn("[getPlayerData] 沒有 userId（參數 / currentUserId / localStorage 都拿不到），回 null"),e.abrupt("return",null);case 13:return e.prev=13,e.next=16,fetch(this.apiBase+"/player/"+encodeURIComponent(u));case 16:if((i=e.sent).ok){e.next=28;break}if(404!==i.status){e.next=20;break}return e.abrupt("return",null);case 20:return e.t1=console,e.t2="取得玩家資料失敗: "+i.status+" ",e.next=24,i.text();case 24:return e.t3=e.sent,e.t4=e.t2+e.t3,e.t1.error.call(e.t1,e.t4),e.abrupt("return",null);case 28:return e.next=30,i.json();case 30:return e.abrupt("return",e.sent);case 33:return e.prev=33,e.t5=e.catch(13),console.error("[getPlayerData] fetch 失敗：",e.t5),e.abrupt("return",null);case 37:case"end":return e.stop()}}),e,this,[[1,6],[13,33]])})));return function(t){return e.apply(this,arguments)}}(),e.savePlayerData=function(){var e=r(n().mark((function e(t){var r,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.useLocalStorage){e.next=3;break}return localStorage.setItem("playerData",JSON.stringify(t)),e.abrupt("return",t);case 3:return e.next=5,fetch(this.apiBase+"/player/"+encodeURIComponent(t.userId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 5:if((r=e.sent).ok){e.next=11;break}return e.next=9,r.text().catch((function(){return""}));case 9:throw a=e.sent,new Error("savePlayerData failed: "+r.status+" "+a);case 11:return e.next=13,r.json();case 13:return s=e.sent,this.setCurrentUser(s.userId),e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.getQuizQuestions=function(){var e=r(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.useLocalStorage){e.next=4;break}return e.abrupt("return",u);case 4:return e.next=6,fetch(this.apiBase+"/quiz");case 6:return t=e.sent,e.next=9,t.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.clearPlayerData=function(){this.useLocalStorage&&(localStorage.removeItem("playerData"),console.log("玩家資料已清除"))},e.getPlayerDataCached=function(){var e=r(n().mark((function e(t){var a,s,u,i,c,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=null!=(a=null==t?void 0:t.maxAgeMs)?a:3e3,i=Date.now(),c=null!=(s=null==t?void 0:t.userId)?s:this.currentUserId,!(this._snapshot&&i-this._snapshotTime<u)||null!=t&&t.refresh){e.next=5;break}return e.abrupt("return",this._snapshot);case 5:if(!this._inFlight){e.next=7;break}return e.abrupt("return",this._inFlight);case 7:return this._inFlight=r(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getPlayerData(c);case 2:return t=e.sent,o._inFlight=null,t&&(o._snapshot=t,o._snapshotTime=Date.now(),o._emit(t)),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))(),e.abrupt("return",this._inFlight);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.refreshPlayerData=function(){var e=r(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getPlayerDataCached({refresh:!0,userId:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.savePlayerDataWithCache=function(){var e=r(n().mark((function e(t){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.savePlayerData(t);case 2:return r=e.sent,this._snapshot=r,this._snapshotTime=Date.now(),this._emit(r),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e}());i.useLocalStorage=!1,i.apiBase="",i.currentUserId=null,i.ready=null,i.readyResolve=null,i.initializing=!1,i._snapshot=null,i._snapshotTime=0,i._inFlight=null,i._listeners=new Set,a._RF.pop()}}}));

System.register("chunks:///_virtual/DevTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataManager.ts","./GameManager.ts"],(function(e){var t,n,r,a,u,i,c,o,s,l,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,u=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){c=e.cclegacy,o=e._decorator,s=e.EditBox,l=e.Component,p=e.find},function(e){f=e.DataManager},function(e){h=e.GameManager}],execute:function(){var d,y,g,v,x,D,m;c._RF.push({},"fe63dMrY9ZGCr/R8Zz3KSud","DevTest",void 0);var b=o.ccclass,w=o.property;e("DevTest",(d=b("DevTest"),y=w(s),g=w(s),d((D=t((x=function(e){function t(){for(var t,n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];return t=e.call.apply(e,[this].concat(u))||this,r(t,"fishIdInput",D,a(t)),r(t,"tempInput",m,a(t)),t}n(t,e);var c=t.prototype;return c.onClearData=function(){f.clearPlayerData()},c.onHungerDeath=function(){var e=u(i().mark((function e(){var t,n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=parseInt(this.fishIdInput.string),!isNaN(n)){e.next=4;break}return console.warn("請輸入正確的魚 ID"),e.abrupt("return");case 4:return e.next=6,null==(t=f.ready)?void 0:t.catch((function(){}));case 6:return e.next=8,f.getPlayerDataCached();case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return");case 11:if(a=r.fishList.find((function(e){return e.id===n}))){e.next=15;break}return console.warn("找不到魚 ID: "+n),e.abrupt("return");case 15:return a.hunger=100,e.next=18,f.savePlayerDataWithCache(r);case 18:console.log("魚 "+a.name+" 飢餓設為 100，將於下次啟動自動死亡");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.onPrintSummary=function(){var e=u(i().mark((function e(){var t,n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=f.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,f.getPlayerDataCached();case 4:if(n=e.sent){e.next=8;break}return console.warn("尚未建立任何玩家資料"),e.abrupt("return");case 8:r=n.fishList.length,a=n.fishList.filter((function(e){return e.isDead})).length,console.log("玩家ID: "+n.userId),console.log("魚數量: "+r),console.log("死魚: "+a);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.toHalfWidth=function(e){return e.replace(/[\uFF01-\uFF5E]/g,(function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})).replace(/\u3000/g," ")},c.onSetTemperature=function(){var e=u(i().mark((function e(){var t,n,r,a,u,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tempInput){e.next=3;break}return console.warn("tempInput 沒有在編輯器綁定到 DevTest！"),e.abrupt("return");case 3:if(r=null!=(t=this.tempInput.string)?t:"",a=this.toHalfWidth(r).trim(),u=parseFloat(a),isFinite(u)){e.next=9;break}return console.warn('請輸入數字水溫（目前輸入: "'+r+'" -> "'+a+'"）'),e.abrupt("return");case 9:return e.next=11,null==(n=f.ready)?void 0:n.catch((function(){}));case 11:return e.next=13,f.getPlayerDataCached();case 13:if(c=e.sent){e.next=16;break}return e.abrupt("return");case 16:return c.tankEnvironment.temperature=u,e.next=19,f.savePlayerDataWithCache(c);case 19:console.log("水溫已設為 "+u+"°C");case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.onSetWaterClean=function(){var e=u(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=f.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,f.getPlayerDataCached();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:return n.tankEnvironment.waterQualityStatus="clean",e.next=10,f.savePlayerDataWithCache(n);case 10:console.log("水質已設為乾淨");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.onSetWaterDirty=function(){var e=u(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=f.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,f.getPlayerDataCached();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:return n.tankEnvironment.waterQualityStatus="dirty",e.next=10,f.savePlayerDataWithCache(n);case 10:console.log("水質已設為髒");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.onSimulateDirtyAndSickToday=function(){var e=u(i().mark((function e(){var t,n,r,a,u,c,o,s,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=f.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,f.getPlayerDataCached();case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:return(u=a.tankEnvironment).waterQualityStatus="dirty",u.loginDaysSinceClean=Math.max(1,null!=(n=u.loginDaysSinceClean)?n:0),u.badEnvLoginDays=1,c=new Date,o=new Date(c.getTime()-864e5),a.lastLoginDate=o.toISOString().split("T")[0],a.lastLoginTime=o.toISOString(),s=JSON.stringify(a,null,2),e.next=18,f.savePlayerDataWithCache(a);case 18:return l=e.sent,console.log("送出的 data:",s),console.log("伺服器回傳 fresh:",JSON.stringify(l,null,2)),d=null==(r=p("/GameManager"))?void 0:r.getComponent(h),e.next=24,null==d?void 0:d.processDailyUpdate();case 24:console.log("今日水質為髒，且依緩衝機制讓一隻魚感冒。");case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t}(l)).prototype,"fishIdInput",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(x.prototype,"tempInput",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=x))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/ExpandMenu.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,i,o,a,s,l,p,c,r,u,h,g,f;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){a=n.cclegacy,s=n._decorator,l=n.Node,p=n.input,c=n.Input,r=n.UIOpacity,u=n.Vec3,h=n.tween,g=n.UITransform,f=n.Component}],execute:function(){var T,_,d,v,y,w,m,B,C;a._RF.push({},"487a7VYpdpMYrEVpwVZ65C0","ExpandMenu",void 0);var E=s.ccclass,b=s.property;n("ExpandMenu",(T=E("ExpandMenu"),_=b(l),d=b(l),v=b(l),T((m=t((w=function(n){function t(){for(var t,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return t=n.call.apply(n,[this].concat(a))||this,i(t,"panel",m,o(t)),i(t,"content",B,o(t)),i(t,"toggleBtn",C,o(t)),t._isOpen=!1,t._isAnimating=!1,t._openTween=void 0,t._closeTween=void 0,t}e(t,n);var a=t.prototype;return a.onLoad=function(){this.initPanelState(!1),this.toggleBtn.on(l.EventType.TOUCH_END,this.onToggle,this),p.on(c.EventType.TOUCH_START,this.onBackgroundTouch,this)},a.onDestroy=function(){var n,t;this.toggleBtn.off(l.EventType.TOUCH_END,this.onToggle,this),p.off(c.EventType.TOUCH_START,this.onBackgroundTouch,this),null==(n=this._openTween)||n.stop(),null==(t=this._closeTween)||t.stop()},a.initPanelState=function(n){var t,e=null!=(t=this.panel.getComponent(r))?t:this.panel.addComponent(r);n?(this.panel.active=!0,this.panel.scale=new u(1,1,1),e.opacity=255):(this.panel.active=!1,this.panel.scale=new u(.8,.8,.8),e.opacity=0)},a.onToggle=function(){this._isAnimating||(this._isOpen?this.close():this.open())},a.open=function(){var n,t=this,e=this.panel.getComponent(r);this.panel.active=!0,this.panel.scale=new u(.8,.8,.8),e.opacity=0,null==(n=this._closeTween)||n.stop(),this._isAnimating=!0,this._openTween=h(this.panel).parallel(h(this.panel).to(.15,{scale:new u(1.02,1.02,1.02)}),h(e).to(.15,{opacity:255})).to(.08,{scale:new u(1,1,1)}).call((function(){t._isAnimating=!1,t._isOpen=!0})).start()},a.close=function(){var n,t=this,e=this.panel.getComponent(r);null==(n=this._openTween)||n.stop(),this._isAnimating=!0,this._closeTween=h(this.panel).to(.12,{scale:new u(.92,.92,.92)}).parallel(h(this.panel).to(.12,{scale:new u(.8,.8,.8)}),h(e).to(.12,{opacity:0})).call((function(){t.panel.active=!1,t._isAnimating=!1,t._isOpen=!1})).start()},a.onBackgroundTouch=function(n){if(this._isOpen&&!this._isAnimating){var t=n.getUILocation();this.isPointInNode(this.panel,t)||this.isPointInNode(this.toggleBtn,t)||this.close()}},a.isPointInNode=function(n,t){var e=n.getComponent(g);return!!e&&e.getBoundingBoxToWorld().contains(t)},t}(f)).prototype,"panel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(w.prototype,"content",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(w.prototype,"toggleBtn",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=w))||y));a._RF.pop()}}}));

System.register("chunks:///_virtual/FishAnimate.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,n,r,o,s,a,l,u,c;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,s=e._decorator,a=e.Node,l=e.tween,u=e.Vec3,c=e.Component}],execute:function(){var g,f,p,h,w,y,b,d,m;o._RF.push({},"cfec2qXdB1LZKH61R24EaR1","FishAnimate",void 0);var A=s.ccclass,v=s.property;e("FishPartsRotateSwing",(g=A("FishAnimate"),f=v({type:a}),p=v({type:a}),g((y=i((w=function(e){function i(){for(var i,t=arguments.length,o=new Array(t),s=0;s<t;s++)o[s]=arguments[s];return i=e.call.apply(e,[this].concat(o))||this,n(i,"fishHand",y,r(i)),n(i,"fishTail",b,r(i)),n(i,"swingAngle",d,r(i)),n(i,"swingTime",m,r(i)),i}t(i,e);var o=i.prototype;return o.start=function(){this.swingNodeRotate(this.fishHand,this.swingAngle,this.swingTime),this.swingNodeRotate(this.fishTail,this.swingAngle,this.swingTime)},o.swingNodeRotate=function(e,i,t){if(e){var n=e.eulerAngles.clone();!function r(){l(e).to(t/2,{eulerAngles:new u(n.x,n.y,n.z+i)}).to(t,{eulerAngles:new u(n.x,n.y,n.z-i)}).to(t/2,{eulerAngles:n}).call(r).start()}()}},i}(c)).prototype,"fishHand",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(w.prototype,"fishTail",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=i(w.prototype,"swingAngle",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),m=i(w.prototype,"swingTime",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),h=w))||h));o._RF.pop()}}}));

System.register("chunks:///_virtual/FishDetailManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SwimmingFish.ts","./FishLogic.ts","./GameManager.ts","./DataManager.ts"],(function(e){var t,n,i,r,a,o,l,u,s,c,h,f,p,b,g,m,d,y,w,v,P,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){l=e.cclegacy,u=e._decorator,s=e.Node,c=e.Label,h=e.Sprite,f=e.SpriteFrame,p=e.EditBox,b=e.UIOpacity,g=e.UITransform,m=e.Vec3,d=e.tween,y=e.Component},function(e){w=e.SwimmingFish},function(e){v=e.FishLogic},function(e){P=e.GameManager},function(e){D=e.DataManager}],execute:function(){var C,T,S,x,B,F,L,z,E,N,k,I,U,O,M,R,_,H,G,Y,A,K,V,W,j,q,J,Q,X,Z,$,ee,te,ne,ie,re,ae,oe,le,ue,se,ce,he,fe,pe,be,ge,me,de,ye,we,ve,Pe,De,Ce,Te,Se,xe,Be,Fe,Le,ze,Ee,Ne,ke,Ie,Ue,Oe,Me,Re,_e,He,Ge,Ye,Ae,Ke,Ve,We,je,qe,Je,Qe,Xe,Ze,$e;l._RF.push({},"87e56rnJ5NE5Yy1vwwEWYcu","FishDetailManager",void 0);var et=u.ccclass,tt=u.property;e("FishDetailManager",(C=et("FishDetailManager"),T=tt(s),S=tt(c),x=tt(c),B=tt(s),F=tt(c),L=tt(c),z=tt(c),E=tt(h),N=tt(c),k=tt(s),I=tt(s),U=tt(s),O=tt(s),M=tt(s),R=tt(s),_=tt(c),H=tt(c),G=tt(s),Y=tt(c),A=tt(s),K=tt(s),V=tt(s),W=tt(s),j=tt(c),q=tt(c),J=tt(s),Q=tt(f),X=tt(f),Z=tt(f),$=tt(f),ee=tt(f),te=tt(f),ne=tt(f),ie=tt(s),re=tt(p),ae=tt(s),oe=tt(s),le=tt(s),ue=tt(c),se=tt(s),ce=tt(s),C((pe=t((fe=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"fishDetailPanel",pe,r(t)),i(t,"fishNameLabel",be,r(t)),i(t,"stageLabel",ge,r(t)),i(t,"renameButton",me,r(t)),i(t,"genderLabel",de,r(t)),i(t,"daysLabel",ye,r(t)),i(t,"hungerLabel",we,r(t)),i(t,"fishStatusImage",ve,r(t)),i(t,"floatingText",Pe,r(t)),i(t,"fashionSection",De,r(t)),i(t,"fashionTabButton",Ce,r(t)),i(t,"healSection",Te,r(t)),i(t,"healTabButton",Se,r(t)),i(t,"genderPotionBtn",xe,r(t)),i(t,"upgradePotionBtn",Be,r(t)),i(t,"genderPotionCountLabel",Fe,r(t)),i(t,"upgradePotionCountLabel",Le,r(t)),i(t,"coldMedicineBtn",ze,r(t)),i(t,"coldMedicineCountLabel",Ee,r(t)),i(t,"feedSection",Ne,r(t)),i(t,"feedTabButton",ke,r(t)),i(t,"feedBtnNormal",Ie,r(t)),i(t,"feedBtnPremium",Ue,r(t)),i(t,"feedNormalCountLabel",Oe,r(t)),i(t,"feedPremiumCountLabel",Me,r(t)),i(t,"closeButton",Re,r(t)),i(t,"happySprite",_e,r(t)),i(t,"sadSprite",He,r(t)),i(t,"angrySprite",Ge,r(t)),i(t,"hungrySprite",Ye,r(t)),i(t,"coldSprite",Ae,r(t)),i(t,"hotSprite",Ke,r(t)),i(t,"sickSprite",Ve,r(t)),i(t,"RenamePanel",We,r(t)),i(t,"renameInput",je,r(t)),i(t,"renameConfirmButton",qe,r(t)),i(t,"renameCancelButton",Je,r(t)),i(t,"confirmDialogPanel",Qe,r(t)),i(t,"confirmDialogText",Xe,r(t)),i(t,"confirmDialogYesButton",Ze,r(t)),i(t,"confirmDialogNoButton",$e,r(t)),t.currentFishId=-1,t.confirmCallback=null,t}n(t,e);var l=t.prototype;return l.start=function(){var e=this;w.setEmotionFrames({happy:this.happySprite,sad:this.sadSprite,angry:this.angrySprite,hungry:this.hungrySprite,cold:this.coldSprite,hot:this.hotSprite,sick:this.sickSprite}),this.closeButton.on(s.EventType.TOUCH_END,this.closeFishDetail,this),this.renameButton.on(s.EventType.TOUCH_END,this.showRenamePanel,this),this.renameConfirmButton.on(s.EventType.TOUCH_END,this.renameFish,this),this.renameCancelButton.on(s.EventType.TOUCH_END,this.hideRenamePanel,this),this.fashionTabButton.on(s.EventType.TOUCH_END,(function(){return e.switchTab("fashion")}),this),this.healTabButton.on(s.EventType.TOUCH_END,(function(){return e.switchTab("heal")}),this),this.feedTabButton.on(s.EventType.TOUCH_END,(function(){return e.switchTab("feed")}),this),this.genderPotionBtn.on(s.EventType.TOUCH_END,this.onUseGenderPotion,this),this.upgradePotionBtn.on(s.EventType.TOUCH_END,this.onUseUpgradePotion,this),this.coldMedicineBtn.on(s.EventType.TOUCH_END,this.onUseColdMedicine,this),this.confirmDialogYesButton.on(s.EventType.TOUCH_END,(function(){e.confirmCallback&&(e.confirmCallback(),e.confirmCallback=null),e.confirmDialogPanel.active=!1}),this),this.confirmDialogNoButton.on(s.EventType.TOUCH_END,(function(){e.confirmCallback=null,e.confirmDialogPanel.active=!1}),this)},l.showFishDetail=function(){var e=a(o().mark((function e(t,n){var i,r,a,l,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!this.fishDetailPanel.active&&(this.fishDetailPanel.active=!0,this.fishDetailPanel.scale=new m(.3,.3,1),d(this.fishDetailPanel).to(.3,{scale:new m(1,1,1)},{easing:"backOut"}).start()),this.currentFishId=t.id,this.switchTab("feed"),this.fishNameLabel.string=t.name,this.genderLabel.string="性別："+("male"===t.gender?"公":"母"),this.daysLabel.string="已成長天數："+t.growthDaysPassed,this.stageLabel.string="LV "+t.stage,this.hungerLabel.string="飢餓值："+Math.floor(t.hunger)+" / 100",e.next=11,D.getPlayerDataCached();case 11:i=e.sent,this.feedNormalCountLabel.string=i.inventory.feeds.normal.toString(),this.feedPremiumCountLabel.string=i.inventory.feeds.premium.toString(),this.genderPotionCountLabel.string=i.inventory.items.genderPotion.toString(),this.upgradePotionCountLabel.string=i.inventory.items.upgradePotion.toString(),this.coldMedicineCountLabel.string=i.inventory.items.coldMedicine.toString(),this.feedBtnNormal.off(s.EventType.TOUCH_END),this.feedBtnPremium.off(s.EventType.TOUCH_END),this.feedBtnNormal.on(s.EventType.TOUCH_END,this.feedNormal,this),this.feedBtnPremium.on(s.EventType.TOUCH_END,this.feedPremium,this),n?this.fishStatusImage.spriteFrame=n:(r=t.emotion)?(a=w.getEmotionSpriteByKey(r),this.fishStatusImage.spriteFrame=a):(l=i.tankEnvironment,u=w.computeEmotion(t,l),c=w.getEmotionSpriteByKey(u),this.fishStatusImage.spriteFrame=c);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),l.feedNormal=function(){this.feedFish(3,"normal")},l.feedPremium=function(){this.feedFish(20,"premium")},l.feedFish=function(){var e=a(o().mark((function e(t,n){var i,r,a,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerDataCached();case 2:if(i=e.sent,r=i.fishList.find((function(e){return e.id===l.currentFishId}))){e.next=6;break}return e.abrupt("return");case 6:if(!(r.hunger<=0)){e.next=9;break}return this.showFloatingTextRightOf(this.hungerLabel.node,"已飽，無需餵食"),e.abrupt("return");case 9:return a=v.feed(r,i.inventory,t,n),console.log(a),e.next=13,D.savePlayerData(i);case 13:this.showFishDetail(r),this.showFloatingTextRightOf(this.hungerLabel.node,"餵食 -"+t);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),l.renameFish=function(){var e=a(o().mark((function e(){var t,n,i,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.renameInput.string.trim()){e.next=4;break}return console.warn("名字不能為空！"),e.abrupt("return");case 4:return e.next=6,D.getPlayerDataCached();case 6:if(n=e.sent,i=n.fishList.find((function(e){return e.id===r.currentFishId}))){e.next=10;break}return e.abrupt("return");case 10:if(v.renameFish(i,t)){e.next=14;break}return console.warn("名字無效"),e.abrupt("return");case 14:return e.next=16,D.savePlayerData(n);case 16:this.hideRenamePanel(),this.showFishDetail(i);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.switchTab=function(e){switch(this.fashionSection.setSiblingIndex(0),this.healSection.setSiblingIndex(0),this.feedSection.setSiblingIndex(0),e){case"fashion":this.fashionSection.setSiblingIndex(99);break;case"heal":this.healSection.setSiblingIndex(99);break;case"feed":this.feedSection.setSiblingIndex(99)}},l.onUseGenderPotion=function(){var e=this;this.showConfirmDialog("確定要使用變性藥嗎？",(function(){return e.useGenderPotion()}))},l.useGenderPotion=function(){var e=a(o().mark((function e(){var t,n,i,r,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerDataCached();case 2:if(t=e.sent,n=t.fishList.find((function(e){return e.id===a.currentFishId}))){e.next=6;break}return e.abrupt("return");case 6:return i=v.useGenderPotion(n,t.inventory.items),e.next=9,D.savePlayerData(t);case 9:console.log(i),this.showFishDetail(n),this.showFloatingTextRightOf(this.genderLabel.node,"變性完成！"),(r=this.node.scene.getComponentInChildren(P))&&r.replaceFishNode(n);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.onUseUpgradePotion=function(){var e=this;this.showConfirmDialog("確定要使用升級藥嗎？",(function(){return e.useUpgradePotion()}))},l.useUpgradePotion=function(){var e=a(o().mark((function e(){var t,n,i,r,a,l,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerDataCached();case 2:if(t=e.sent,n=t.fishList.find((function(e){return e.id===u.currentFishId}))){e.next=6;break}return e.abrupt("return");case 6:return i=v.useUpgradePotion(n,t.inventory.items),r=i.message,a=i.upgraded,e.next=9,D.savePlayerData(t);case 9:return console.log(r),e.next=12,this.showFishDetail(n);case 12:this.showFloatingTextRightOf(this.daysLabel.node,"成長天數 +5"),a&&(l=this.node.scene.getComponentInChildren(P))&&l.replaceFishNode(n);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.onUseColdMedicine=function(){var e=this;this.showConfirmDialog("確定要使用感冒藥嗎？",(function(){return e.useColdMedicine()}))},l.useColdMedicine=function(){var e=a(o().mark((function e(){var t,n,i,r,a,l,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerDataCached();case 2:if(t=e.sent,n=t.fishList.find((function(e){return e.id===u.currentFishId}))){e.next=6;break}return e.abrupt("return");case 6:return i=v.useColdMedicine(n,t.inventory.items),r=i.message,a=i.cured,e.next=9,D.savePlayerData(t);case 9:if(console.log(r),!a){e.next=16;break}return(l=this.node.scene.getComponentInChildren(P))&&l.replaceFishNode(n),this.showFloatingTextRightOf(this.fishStatusImage.node,"已治癒！"),e.next=16,this.showFishDetail(n);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.showFloatingTextRightOf=function(e,t){var n=this.floatingText.node,i=n.getComponent(b);if(i){this.floatingText.string=t,n.active=!0,i.opacity=0;var r=e.getComponent(g).getBoundingBoxToWorld(),a=new m(r.xMax+10,(r.yMin+r.yMax)/2,0),o=n.parent.getComponent(g).convertToNodeSpaceAR(a);n.setPosition(o);var l=o.clone().add(new m(0,30,0));d(i).to(.1,{opacity:255}).delay(.4).to(.2,{opacity:0}).call((function(){return n.active=!1})).start(),d(n).to(.6,{position:l},{easing:"quadOut"}).start()}else console.warn("FloatingText node is missing UIOpacity component!")},l.hideAllSubPanels=function(){this.RenamePanel.active=!1},l.closeFishDetail=function(){this.fishDetailPanel.active=!1,this.hideAllSubPanels(),w.clearSelection()},l.showRenamePanel=function(){var e=a(o().mark((function e(){var t,n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerDataCached();case 2:if(t=e.sent,n=t.fishList.find((function(e){return e.id===i.currentFishId}))){e.next=6;break}return e.abrupt("return");case 6:this.renameInput.string=n.name,this.RenamePanel.active=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.hideRenamePanel=function(){this.RenamePanel.active=!1},l.showConfirmDialog=function(e,t){this.confirmDialogText.string=e,this.confirmDialogPanel.active=!0,this.confirmCallback=t},t}(y)).prototype,"fishDetailPanel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=t(fe.prototype,"fishNameLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(fe.prototype,"stageLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=t(fe.prototype,"renameButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(fe.prototype,"genderLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ye=t(fe.prototype,"daysLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),we=t(fe.prototype,"hungerLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(fe.prototype,"fishStatusImage",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(fe.prototype,"floatingText",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),De=t(fe.prototype,"fashionSection",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(fe.prototype,"fashionTabButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=t(fe.prototype,"healSection",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(fe.prototype,"healTabButton",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xe=t(fe.prototype,"genderPotionBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=t(fe.prototype,"upgradePotionBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=t(fe.prototype,"genderPotionCountLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=t(fe.prototype,"upgradePotionCountLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=t(fe.prototype,"coldMedicineBtn",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ee=t(fe.prototype,"coldMedicineCountLabel",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(fe.prototype,"feedSection",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ke=t(fe.prototype,"feedTabButton",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=t(fe.prototype,"feedBtnNormal",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(fe.prototype,"feedBtnPremium",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=t(fe.prototype,"feedNormalCountLabel",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=t(fe.prototype,"feedPremiumCountLabel",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=t(fe.prototype,"closeButton",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=t(fe.prototype,"happySprite",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),He=t(fe.prototype,"sadSprite",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ge=t(fe.prototype,"angrySprite",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=t(fe.prototype,"hungrySprite",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ae=t(fe.prototype,"coldSprite",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ke=t(fe.prototype,"hotSprite",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ve=t(fe.prototype,"sickSprite",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),We=t(fe.prototype,"RenamePanel",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je=t(fe.prototype,"renameInput",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qe=t(fe.prototype,"renameConfirmButton",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Je=t(fe.prototype,"renameCancelButton",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qe=t(fe.prototype,"confirmDialogPanel",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xe=t(fe.prototype,"confirmDialogText",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ze=t(fe.prototype,"confirmDialogYesButton",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$e=t(fe.prototype,"confirmDialogNoButton",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he=fe))||he));l._RF.pop()}}}));

System.register("chunks:///_virtual/FishLogic.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"3c40aGigUFOeZwflbv+5hJh","FishLogic",void 0);e("FishLogic",function(){function e(){}return e.feed=function(e,n,t,a){return n.feeds[a]<=0?"沒有 "+("normal"===a?"普通":"高級")+"飼料了":(n.feeds[a]--,e.hunger=Math.max(0,e.hunger-t),e.lastFedDate=(new Date).toISOString(),"已餵食 "+e.name+"，飢餓值 -"+t)},e.renameFish=function(e,n){return!(!n||n.length>12)&&(e.name=n,!0)},e.getEmotionKey=function(e){return"happy"===e.emotion?"happy":"sad"===e.emotion?"sad":null},e.useUpgradePotion=function(e,n){if(n.upgradePotion<=0)return{message:"沒有升級藥了",upgraded:!1};if(e.isDead)return{message:"魚已死亡，不能使用升級藥",upgraded:!1};if(e.stage>=6)return{message:"這隻魚已達最高階段",upgraded:!1};n.upgradePotion--,e.growthDaysPassed+=5;var t=this.tryStageUpgradeByGrowthDays(e);return{message:t?e.name+" 升級為第 "+e.stage+" 階！（吃藥長大）":e.name+" 成長天數 +5",upgraded:t}},e.useGenderPotion=function(e,n){return n.genderPotion<=0?"沒有變性藥了":e.isDead?"魚已死亡，不能變性":(n.genderPotion--,e.gender="male"===e.gender?"female":"male",e.name+" 的性別已變更為 "+("male"===e.gender?"公":"母"))},e.useColdMedicine=function(e,n){return n.coldMedicine<=0?{message:"沒有感冒藥了",cured:!1}:e.isDead?{message:"魚已死亡，不能使用感冒藥",cured:!1}:(e.status||(e.status={sick:!1}),e.status.sick?(n.coldMedicine-=1,e.status.sick=!1,e.emotion="happy",{message:e.name+" 已治癒",cured:!0}):{message:e.name+" 並沒有生病",cured:!1})},e.tryStageUpgradeByGrowthDays=function(e){for(var n={1:0,2:5,3:15,4:35,5:60,6:90},t=!1;e.stage<6&&e.growthDaysPassed>=n[e.stage+1];)e.stage++,t=!0;return t},e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SwimmingFish.ts","./DataManager.ts","./FishLogic.ts","./TombManager.ts","./TankEnvironmentManager.ts","./utils.ts","./LiffBridge.ts","./Api.ts"],(function(e){var t,n,r,a,i,o,s,u,l,c,h,f,p,b,m,g,y,d,v,w,D,k,x,C,T,B,L,F;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime,s=e.createForOfIteratorHelperLoose},function(e){u=e.cclegacy,l=e._decorator,c=e.Node,h=e.Prefab,f=e.Button,p=e.Label,b=e.instantiate,m=e.Vec3,g=e.UIOpacity,y=e.tween,d=e.Component,v=e.UITransform},function(e){w=e.SwimmingFish},function(e){D=e.DataManager},function(e){k=e.FishLogic},function(e){x=e.TombManager},function(e){C=e.TankEnvironmentManager},function(e){T=e.getOrCreateUserId},function(e){B=e.getIdentity,L=e.initLiff},function(e){F=e.authWithLine}],execute:function(){var E,P,N,z,O,I,S,M,U,H,_,A,G,Q,W,R,Y,j,V,q,J,Z,K,X,$,ee,te,ne,re,ae,ie,oe,se,ue,le,ce,he,fe,pe,be,me,ge,ye,de,ve,we,De,ke,xe,Ce,Te,Be,Le,Fe,Ee,Pe,Ne,ze,Oe,Ie,Se,Me,Ue,He,_e;u._RF.push({},"d13bcYsAP9GrbI7DBywQwwD","GameManager",void 0);var Ae=l.ccclass,Ge=l.property;e("GameManager",(E=Ae("GameManager"),P=Ge(x),N=Ge(c),z=Ge([h]),O=Ge([h]),I=Ge([f]),S=Ge(f),M=Ge([c]),U=Ge(c),H=Ge(c),_=Ge(p),A=Ge(p),G=Ge(f),Q=Ge(f),W=Ge(f),R=Ge(p),Y=Ge(p),j=Ge(p),V=Ge(c),q=Ge(c),J=Ge(c),Z=Ge(c),K=Ge(p),X=Ge(c),$=Ge(c),ee=Ge(c),te=Ge(p),ne=Ge(f),re=Ge(c),ae=Ge(f),ie=Ge(c),E((ue=t((se=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,r(t,"tombManager",ue,a(t)),r(t,"fishArea",le,a(t)),r(t,"maleFishPrefabsByStage",ce,a(t)),r(t,"femaleFishPrefabsByStage",he,a(t)),r(t,"tankButtons",fe,a(t)),r(t,"tombTankBtn",pe,a(t)),r(t,"tankNodes",be,a(t)),r(t,"tombTankNode",me,a(t)),r(t,"signInPanel",ge,a(t)),r(t,"temperatureLabel",ye,a(t)),r(t,"waterQualityLabel",de,a(t)),r(t,"minComfortTemp",ve,a(t)),r(t,"maxComfortTemp",we,a(t)),r(t,"heaterBtn",De,a(t)),r(t,"fanBtn",ke,a(t)),r(t,"brushBtn",xe,a(t)),r(t,"heaterCountLabel",Ce,a(t)),r(t,"fanCountLabel",Te,a(t)),r(t,"brushCountLabel",Be,a(t)),r(t,"dirtyWaterOverlay",Le,a(t)),r(t,"coldOverlay",Fe,a(t)),r(t,"hotOverlay",Ee,a(t)),r(t,"confirmDialogPanel",Pe,a(t)),r(t,"confirmDialogText",Ne,a(t)),r(t,"confirmDialogYesButton",ze,a(t)),r(t,"confirmDialogNoButton",Oe,a(t)),r(t,"deathNoticePanel",Ie,a(t)),r(t,"deathNoticeLabel",Se,a(t)),r(t,"deathNoticeCloseBtn",Me,a(t)),r(t,"tombHintPanel",Ue,a(t)),r(t,"tombHintCloseBtn",He,a(t)),r(t,"floatingNode",_e,a(t)),t.confirmCallback=null,t.currentTankId=1,t.playerData=null,t.userId=T(),t}n(t,e);var u=t.prototype;return u.start=function(){var e=i(o().mark((function e(){var t,n,r,a,i,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new URLSearchParams(window.location.search),r="1"===n.get("dev"),e.prev=2,!r){e.next=13;break}return console.warn("[Game] 強制 DEV 模式"),D.useLocalStorage=!0,e.next=8,D.init("DEV_LOCAL");case 8:return e.next=10,D.getPlayerData();case 10:this.playerData=e.sent,e.next=30;break;case 13:return e.next=15,L("2007937783-PJ4ZRBdY");case 15:return e.next=17,B();case 17:if(a=e.sent,i=a.idToken){e.next=21;break}throw new Error("取不到 idToken，請用 LINE App / LIFF URL 開啟");case 21:return e.next=23,F(i);case 23:return s=e.sent,u=s.lineUserId,e.next=27,D.init(u);case 27:return e.next=29,D.getPlayerData();case 29:this.playerData=e.sent;case 30:e.next=36;break;case 32:return e.prev=32,e.t0=e.catch(2),console.error("[Game] 啟動失敗，錯誤：",e.t0),e.abrupt("return");case 36:if(this.playerData){e.next=39;break}return console.error("玩家資料讀取失敗"),e.abrupt("return");case 39:return e.next=41,this.processDailyUpdate();case 41:return this.initButtons(),this.initDialogs(),this.initPanels(),e.next=46,this.switchTank(1);case 46:return e.next=48,null==(t=this.tombManager)?void 0:t.init();case 48:return e.next=50,this.refreshEnvironmentUI();case 50:case"end":return e.stop()}}),e,this,[[2,32]])})));return function(){return e.apply(this,arguments)}}(),u.initButtons=function(){var e,t,n,r=this;this.tankButtons.forEach((function(e,t){e.node.on(c.EventType.TOUCH_END,(function(){return r.switchTank(t+1)}))})),this.tombTankBtn.node.on(c.EventType.TOUCH_END,(function(){return r.switchToTombTank()})),null==(e=this.heaterBtn)||e.node.on(c.EventType.TOUCH_END,(function(){return r.onClickHeater()})),null==(t=this.fanBtn)||t.node.on(c.EventType.TOUCH_END,(function(){return r.onClickFan()})),null==(n=this.brushBtn)||n.node.on(c.EventType.TOUCH_END,(function(){return r.onClickBrush()}))},u.initDialogs=function(){var e,t,n=this;null==(e=this.confirmDialogYesButton)||e.on(c.EventType.TOUCH_END,(function(){if(n.confirmCallback){var e=n.confirmCallback;n.confirmCallback=null,n.confirmDialogPanel.active=!1,e()}else n.confirmDialogPanel.active=!1})),null==(t=this.confirmDialogNoButton)||t.on(c.EventType.TOUCH_END,(function(){n.confirmCallback=null,n.confirmDialogPanel.active=!1}))},u.initPanels=function(){var e=this;this.signInPanel&&(this.signInPanel.active=!0),this.deathNoticeCloseBtn.node.on(c.EventType.TOUCH_END,(function(){e.deathNoticePanel.active=!1,e.tombHintPanel.active=!0})),this.tombHintCloseBtn.node.on(c.EventType.TOUCH_END,(function(){e.tombHintPanel.active=!1}))},u.switchTank=function(){var e=i(o().mark((function e(t){var n,r,a,i,u,l,c,h=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getPlayerData();case 2:if(this.playerData=e.sent,this.tankNodes.forEach((function(e,n){e.active=n+1===t})),this.tombTankNode.active=!1,this.fishArea.removeAllChildren(),n=this.playerData.tankList.find((function(e){return e.id===t}))){e.next=10;break}return console.warn("找不到魚缸 "+t),e.abrupt("return");case 10:r=this.fishArea.getComponent(v),a=r.width,i=r.height,50,u=o().mark((function e(){var t,n,r,s,u,l,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,(n=h.playerData.fishList.find((function(e){return e.id===t})))&&!n.isDead){e.next=4;break}return e.abrupt("return",0);case 4:if(r="female"===n.gender?h.femaleFishPrefabsByStage[n.stage-1]:h.maleFishPrefabsByStage[n.stage-1]){e.next=7;break}return e.abrupt("return",0);case 7:(s=b(r)).name="Fish_"+n.id,u=Math.random()*(a-100)-(a/2-50),l=Math.random()*(i-100)-(i/2-50),f=Math.random()>.5?1:-1,s.setPosition(u,l,0),s.setScale(new m(f,1,1)),s.initialDirection=f,null==(p=s.getComponent(w))||p.setFishData(n),h.fishArea.addChild(s);case 18:case"end":return e.stop()}}),e)})),l=s(n.fishIds);case 16:if((c=l()).done){e.next=23;break}return e.delegateYield(u(),"t0",18);case 18:if(0!==e.t0){e.next=21;break}return e.abrupt("continue",21);case 21:e.next=16;break;case 23:this.currentTankId=t;case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.switchToTombTank=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tankNodes.forEach((function(e){return e.active=!1})),this.tombTankNode.active=!0,e.next=4,null==(t=this.tombManager)?void 0:t.refreshTombs();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.processDailyUpdate=function(){var e=i(o().mark((function e(){var t,n,r,a,i,u,l,c,h,f,p,b,m,g,y,d,v,w,x,T,B,L;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new Date,n=t.toISOString().split("T")[0],r=this.playerData.lastLoginDate||n,a=new Date(this.playerData.lastLoginTime||t),i=this.playerData.tankEnvironment,u=(t.getTime()-a.getTime())/36e5,l=Math.floor((Date.parse(n)-Date.parse(r))/864e5),c=100/72,h=2,f=[],null==i.badEnvLoginDays&&(i.badEnvLoginDays=0),p=s(this.playerData.fishList);case 12:if((b=p()).done){e.next=32;break}if(!(y=b.value).isDead){e.next=16;break}return e.abrupt("continue",30);case 16:if(d=null!=(m=y.hungerRateMultiplier)?m:1,v=null!=(g=y.status)&&g.sick?1.5:1,w=c*d*v,y.hunger+=u*w,y.hunger=Math.min(y.hunger,100),!(y.hunger>=100)){e.next=28;break}return y.isDead=!0,y.deathDate=n,y.emotion="dead",f.push(y.name),console.log(y.name+" 因飢餓過久而死亡"),e.abrupt("continue",30);case 28:l>0&&(y.growthDaysPassed+=l,k.tryStageUpgradeByGrowthDays(y)&&console.log(y.name+" 升級為第 "+y.stage+" 階！（自然長大）")),y.hunger>=80&&(y.emotion="hungry");case 30:e.next=12;break;case 32:return null==i.loginDaysSinceClean&&(i.loginDaysSinceClean=0),l>0&&(i.loginDaysSinceClean+=1),C.shouldUpdateTemperature(this.playerData)&&C.updateTemperature(this.playerData),C.checkWaterDirty(this.playerData),l>0&&(C.isEnvBad(this.playerData)?i.badEnvLoginDays+=1:i.badEnvLoginDays=0,i.badEnvLoginDays>=h&&(x=this.playerData.fishList.filter((function(e){return!e.isDead&&!e.status.sick}))).length>0&&(T=Math.floor(Math.random()*x.length),x[T].status.sick=!0,console.log("環境不良已持續 "+i.badEnvLoginDays+" 天，"+x[T].name+" 生病了"),i.badEnvLoginDays=0)),f.length>0&&(B=f.join("、"),L=B+"\n因為太餓，沒能撐下去...\n但牠的記憶還在某個地方等你",this.showDeathNotice(L)),this.playerData.lastLoginDate=n,this.playerData.lastLoginTime=t.toISOString(),e.next=42,D.savePlayerData(this.playerData);case 42:return e.next=44,this.refreshEnvironmentUI();case 44:console.log("更新完成：經過 "+u.toFixed(2)+" 小時，飢餓與成長資料已更新");case 45:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.spawnFishInTank=function(){var e=i(o().mark((function e(t){var n,r,a,i,u,l,c,h=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.fishArea.removeAllChildren(),n=this.playerData.tankList.find((function(e){return e.id===t}))){e.next=5;break}return console.warn("找不到魚缸 "+t),e.abrupt("return");case 5:r=this.fishArea.getComponent(v),a=r.width,i=r.height,50,u=o().mark((function e(){var t,n,r,s,u,l,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,(n=h.playerData.fishList.find((function(e){return e.id===t})))&&!n.isDead){e.next=4;break}return e.abrupt("return",0);case 4:if(r="female"===n.gender?h.femaleFishPrefabsByStage[n.stage-1]:h.maleFishPrefabsByStage[n.stage-1]){e.next=7;break}return e.abrupt("return",0);case 7:(s=b(r)).name="Fish_"+n.id,u=Math.random()*(a-100)-(a/2-50),l=Math.random()*(i-100)-(i/2-50),f=Math.random()>.5?1:-1,s.setPosition(u,l,0),s.setScale(new m(f,1,1)),s.initialDirection=f,null==(p=s.getComponent(w))||p.setFishData(n),h.fishArea.addChild(s);case 18:case"end":return e.stop()}}),e)})),l=s(n.fishIds);case 11:if((c=l()).done){e.next=18;break}return e.delegateYield(u(),"t0",13);case 13:if(0!==e.t0){e.next=16;break}return e.abrupt("continue",16);case 16:e.next=11;break;case 18:this.currentTankId=t;case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.replaceFishNode=function(e){var t,n=this.fishArea.getChildByName("Fish_"+e.id);if(!n)return console.warn("找不到原魚節點 Fish_"+e.id),null;var r=n.getPosition(),a=null!=(t=n.initialDirection)?t:1;n.destroy();var i=e.stage-1,o="male"===e.gender?this.maleFishPrefabsByStage[i]:this.femaleFishPrefabsByStage[i];if(!o)return console.warn("找不到對應魚 prefab：stage="+e.stage+", gender="+e.gender),null;var s=b(o);s.name="Fish_"+e.id,s.setPosition(r),s.initialDirection=a,s.setScale(new m(a,1,1)),this.fishArea.addChild(s);var u=s.getComponent(w);return u&&(u.setFishData(e),null==u.onClickFish||u.onClickFish()),s},u.showDeathNotice=function(e){this.deathNoticeLabel.string=e,this.deathNoticePanel.active=!0},u.refreshEnvironmentUI=function(){var e=i(o().mark((function e(){var t,n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerData){e.next=2;break}return e.abrupt("return");case 2:t=this.playerData.tankEnvironment,n=this.playerData.inventory.items,this.temperatureLabel&&(this.temperatureLabel.string="水溫 : "+t.temperature.toFixed(1)+"°C"),this.waterQualityLabel&&(this.waterQualityLabel.string="clean"===t.waterQualityStatus?"水質 : 乾淨":"水質 : 髒"),this.dirtyWaterOverlay&&(this.dirtyWaterOverlay.active="clean"!==t.waterQualityStatus),this.heaterCountLabel&&(this.heaterCountLabel.string=""+n.heater),this.fanCountLabel&&(this.fanCountLabel.string=""+n.fan),this.brushCountLabel&&(this.brushCountLabel.string=""+n.brush),r=t.temperature<this.minComfortTemp,a=t.temperature>this.maxComfortTemp,this.heaterBtn&&(this.heaterBtn.interactable=n.heater>0&&r),this.fanBtn&&(this.fanBtn.interactable=n.fan>0&&a),this.brushBtn&&(this.brushBtn.interactable=n.brush>0),this.updateEnvironmentOverlays(t);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.onClickHeater=function(){var e=i(o().mark((function e(){var t,n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerData.inventory.items,n=this.playerData.tankEnvironment,!(t.heater<=0)){e.next=5;break}return this.showFloatingTextCenter("加熱器不足"),e.abrupt("return");case 5:if(!(n.temperature>=this.minComfortTemp&&n.temperature<=this.maxComfortTemp)){e.next=8;break}return this.showFloatingTextCenter("目前水溫正常，無需使用加熱器"),e.abrupt("return");case 8:if(!(n.temperature>this.maxComfortTemp)){e.next=11;break}return this.showFloatingTextCenter("目前為高溫狀態，請使用風扇"),e.abrupt("return");case 11:this.showConfirmDialog("確定要使用加熱器嗎？",(function(){return r.useHeater()}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.useHeater=function(){var e=i(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerData.inventory.items,n=this.playerData.tankEnvironment,!(t.heater<=0)){e.next=5;break}return this.showFloatingTextCenter("加熱器不足"),e.abrupt("return");case 5:if(!(n.temperature>=this.minComfortTemp)){e.next=8;break}return this.showFloatingTextCenter("目前水溫不低，不需使用加熱器"),e.abrupt("return");case 8:return t.heater-=1,C.adjustTemperature(this.playerData),e.next=12,D.savePlayerData(this.playerData);case 12:return e.next=14,this.refreshEnvironmentUI();case 14:this.showFloatingTextCenter("已使用加熱器");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.onClickFan=function(){var e=i(o().mark((function e(){var t,n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerData.inventory.items,n=this.playerData.tankEnvironment,!(t.fan<=0)){e.next=5;break}return this.showFloatingTextCenter("風扇不足"),e.abrupt("return");case 5:if(!(n.temperature>=this.minComfortTemp&&n.temperature<=this.maxComfortTemp)){e.next=8;break}return this.showFloatingTextCenter("目前水溫正常，無需使用風扇"),e.abrupt("return");case 8:if(!(n.temperature<this.minComfortTemp)){e.next=11;break}return this.showFloatingTextCenter("目前為低溫狀態，請使用加熱器"),e.abrupt("return");case 11:this.showConfirmDialog("確定要使用風扇嗎？",(function(){return r.useFan()}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.useFan=function(){var e=i(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerData.inventory.items,n=this.playerData.tankEnvironment,!(t.fan<=0)){e.next=5;break}return this.showFloatingTextCenter("風扇不足"),e.abrupt("return");case 5:if(!(n.temperature<=this.maxComfortTemp)){e.next=8;break}return this.showFloatingTextCenter("目前水溫不高，不需使用風扇"),e.abrupt("return");case 8:return t.fan-=1,C.adjustTemperature(this.playerData),e.next=12,D.savePlayerData(this.playerData);case 12:return e.next=14,this.refreshEnvironmentUI();case 14:this.showFloatingTextCenter("已使用風扇");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.onClickBrush=function(){var e=i(o().mark((function e(){var t,n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerData.inventory.items,n=this.playerData.tankEnvironment,!(t.brush<=0)){e.next=5;break}return this.showFloatingTextCenter("魚缸刷不足"),e.abrupt("return");case 5:if("clean"!==n.waterQualityStatus){e.next=8;break}return this.showFloatingTextCenter("目前魚缸很乾淨，無需使用魚缸刷"),e.abrupt("return");case 8:this.showConfirmDialog("確定要使用魚缸刷嗎？",(function(){return r.useBrush()}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.useBrush=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.playerData.inventory.items).brush<=0)){e.next=4;break}return this.showFloatingTextCenter("魚缸刷不足"),e.abrupt("return");case 4:return t.brush-=1,C.cleanWater(this.playerData),e.next=8,D.savePlayerData(this.playerData);case 8:return e.next=10,this.refreshEnvironmentUI();case 10:this.showFloatingTextCenter("已清潔魚缸");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.updateEnvironmentOverlays=function(e){var t="clean"!==e.waterQualityStatus,n=e.temperature<this.minComfortTemp,r=e.temperature>this.maxComfortTemp;this.dirtyWaterOverlay&&(this.dirtyWaterOverlay.active=t),this.coldOverlay&&(this.coldOverlay.active=!t&&n),this.hotOverlay&&(this.hotOverlay.active=!t&&r)},u.showFloatingTextCenter=function(e){var t=this.floatingNode,n=null==t?void 0:t.getComponentInChildren(p),r=null==t?void 0:t.getComponent(g);if(t&&n&&r){y(t).stop(),y(r).stop(),n.string=e,t.active=!0,r.opacity=0;var a=new m(0,0,0),i=new m(0,30,0);t.setPosition(a),y(r).to(.3,{opacity:255}).delay(1.2).to(.4,{opacity:0}).call((function(){return t.active=!1})).start(),y(t).to(1.2,{position:i},{easing:"quadOut"}).start()}else console.warn("floatingNode 缺少 Node / Label / UIOpacity 元件")},u.showConfirmDialog=function(e,t){this.confirmDialogPanel&&this.confirmDialogText&&(this.confirmDialogText.string=e,this.confirmCallback=t,this.confirmDialogPanel.active=!0)},t}(d)).prototype,"tombManager",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=t(se.prototype,"fishArea",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=t(se.prototype,"maleFishPrefabsByStage",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),he=t(se.prototype,"femaleFishPrefabsByStage",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fe=t(se.prototype,"tankButtons",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pe=t(se.prototype,"tombTankBtn",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=t(se.prototype,"tankNodes",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),me=t(se.prototype,"tombTankNode",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(se.prototype,"signInPanel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ye=t(se.prototype,"temperatureLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(se.prototype,"waterQualityLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(se.prototype,"minComfortTemp",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 18}}),we=t(se.prototype,"maxComfortTemp",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 23}}),De=t(se.prototype,"heaterBtn",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ke=t(se.prototype,"fanBtn",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xe=t(se.prototype,"brushBtn",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(se.prototype,"heaterCountLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=t(se.prototype,"fanCountLabel",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=t(se.prototype,"brushCountLabel",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=t(se.prototype,"dirtyWaterOverlay",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=t(se.prototype,"coldOverlay",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ee=t(se.prototype,"hotOverlay",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(se.prototype,"confirmDialogPanel",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(se.prototype,"confirmDialogText",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=t(se.prototype,"confirmDialogYesButton",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=t(se.prototype,"confirmDialogNoButton",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=t(se.prototype,"deathNoticePanel",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(se.prototype,"deathNoticeLabel",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=t(se.prototype,"deathNoticeCloseBtn",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(se.prototype,"tombHintPanel",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),He=t(se.prototype,"tombHintCloseBtn",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=t(se.prototype,"floatingNode",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oe=se))||oe));u._RF.pop()}}}));

System.register("chunks:///_virtual/LiffBridge.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n,t,i;return{setters:[function(e){r=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){t=e.cclegacy,i=e.sys}],execute:function(){function f(){return(f=r(n().mark((function e(r){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isBrowser){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==window.liff){e.next=4;break}throw new Error("LIFF SDK not loaded");case 4:return e.next=6,liff.init({liffId:r});case 6:liff.isLoggedIn()||liff.login();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(){return(o=r(n().mark((function e(){var r,t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isBrowser&&void 0!==window.liff){e.next=2;break}return e.abrupt("return",{idToken:null,profile:null});case 2:return e.next=4,liff.getProfile();case 4:return r=e.sent,t=liff.getIDToken(),e.abrupt("return",{idToken:t,profile:r});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e({getIdentity:function(){return o.apply(this,arguments)},initLiff:function(e){return f.apply(this,arguments)}}),t._RF.push({},"dcf75MsRwZLDZnYvsEwcanH","LiffBridge",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./DataManager.ts","./ExpandMenu.ts","./FishAnimate.ts","./FishDetailManager.ts","./FishLogic.ts","./GameManager.ts","./RenamePanel.ts","./RewardItem.ts","./RewardPopup.ts","./SwimmingFish.ts","./TankEnvironmentManager.ts","./TombManager.ts","./Api.ts","./LiffBridge.ts","./QuizData.ts","./QuizPanel.ts","./MonthlySignInManager.ts","./SignInPanel.ts","./WeeklySignInManager.ts","./DevTest.ts","./utils.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MonthlySignInManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataManager.ts","./RewardPopup.ts","./utils.ts"],(function(e){var t,n,a,r,i,o,l,u,s,p,c,m,h,d,y,g,f,b,S,w,F;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){l=e.cclegacy,u=e._decorator,s=e.Node,p=e.Label,c=e.Button,m=e.Prefab,h=e.SpriteFrame,d=e.Component,y=e.UITransform,g=e.Vec3,f=e.tween,b=e.instantiate},function(e){S=e.DataManager},function(e){w=e.RewardPopup},function(e){F=e.getRandomItem}],execute:function(){var D,I,v,C,N,k,z,L,B,P,M,x,R,T,G,H,U,_,O,j,A,q,E,J,V,W,Y;l._RF.push({},"8f2972wm8JN0q4CufjSwzBR","MonthlySignInManager",void 0);var K=u.ccclass,Q=u.property;e("MonthlySignInManager",(D=K("MonthlySignInManager"),I=Q(s),v=Q(p),C=Q(c),N=Q(p),k=Q(m),z=Q(s),L=Q(h),B=Q(h),P=Q(h),M=Q(h),x=Q(h),R=Q(h),D((H=t((G=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,a(t,"daysGrid",H,r(t)),a(t,"monthlyCountLabel",U,r(t)),a(t,"claimButton",_,r(t)),a(t,"signInHintLabel",O,r(t)),a(t,"rewardPopupPrefab",j,r(t)),a(t,"flyingStampNode",A,r(t)),a(t,"normalFeedSpriteFrame",q,r(t)),a(t,"premiumFeedSpriteFrame",E,r(t)),a(t,"fanSpriteFrame",J,r(t)),a(t,"heaterSpriteFrame",V,r(t)),a(t,"brushSpriteFrame",W,r(t)),a(t,"defaultSpriteFrame",Y,r(t)),t.dayLabels=[],t.dayStampNodes=[],t.playerData=void 0,t}n(t,e);var l=t.prototype;return l.start=function(){var e=i(o().mark((function e(){var t,n,a,r,i,l,u,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=S.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,S.getPlayerData();case 4:if(this.playerData=e.sent,this.playerData&&this.playerData.signInData){e.next=8;break}return console.warn("[MonthlySignIn] 尚未取得玩家資料，停用本元件初始化"),e.abrupt("return");case 8:this.initDayNodes(),n=new Date,a=n.getMonth()+1,r=n.getFullYear(),i=n.toISOString().split("T")[0],(l=this.playerData.signInData.monthly).month===a&&l.year===r||(l.month=a,l.year=r,l.signedDaysCount=0,l.lastSignDate=""),this.updateSignInUI(),u=l.lastSignDate===i,s=l.signedDaysCount>=this.dayStampNodes.length,this.claimButton.interactable=!u&&!s,this.signInHintLabel.string=s?"本月已完成簽到":u?"今日已簽到":"點擊簽到",this.claimButton.node.on("click",this.onClaimButtonClick,this);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.initDayNodes=function(){this.dayLabels=[],this.dayStampNodes=[];for(var e=0;e<this.daysGrid.children.length;e++){var t=this.daysGrid.children[e],n=t.getChildByName("Status"),a=t.getChildByName("Stamp");if(n&&a){var r=n.getComponent(p);r&&(this.dayLabels.push(r),this.dayStampNodes.push(a))}}},l.updateSignInUI=function(){var e=this.playerData.signInData.monthly;this.monthlyCountLabel.string="本月累計簽到第 "+e.signedDaysCount+" 天";for(var t=0;t<this.dayLabels.length;t++){var n=this.dayLabels[t],a=this.dayStampNodes[t];n.string=""+(t+1),t<e.signedDaysCount?a.active=!0:a.active=!1}},l.addInventoryItem=function(e,t){var n=this.playerData.inventory;"normalFeed"===e?n.feeds.normal+=t:"premiumFeed"===e?n.feeds.premium+=t:e in n.items?n.items[e]+=t:console.warn("未知的物品 key: "+e)},l.onClaimButtonClick=function(){var e=i(o().mark((function e(){var t,n,a,r,i,l,u,s,p,c,m,h,d,D,I,v=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Date,n=t.toISOString().split("T")[0],!((a=this.playerData.signInData.monthly).lastSignDate===n||a.signedDaysCount>=this.dayStampNodes.length)){e.next=5;break}return e.abrupt("return");case 5:if(!((r=a.signedDaysCount)>=this.dayStampNodes.length)){e.next=9;break}return console.warn("簽到格子數量不足"),e.abrupt("return");case 9:return i=this.dayStampNodes[r],a.signedDaysCount++,a.lastSignDate=n,l=t.getDay(),u=[],0===l||6===l?(s=F([{key:"premiumFeed",name:"高級飼料",count:1},{key:"fan",name:"風扇",count:1},{key:"heater",name:"加熱器",count:1},{key:"brush",name:"魚缸刷",count:1}]),this.addInventoryItem(s.key,s.count),u.push({icon:this.getIconSpriteFrame(s.key),name:s.name,count:s.count})):(this.addInventoryItem("normalFeed",1),u.push({icon:this.getIconSpriteFrame("normalFeed"),name:"普通飼料",count:1})),u.forEach((function(e){console.log("月簽到獎勵："+e.name+" x"+e.count)})),e.next=18,S.savePlayerData(this.playerData);case 18:this.claimButton.interactable=!1,this.signInHintLabel.string="今日已簽到",p=i.getComponent(y).getBoundingBoxToWorld(),c=new g(p.x+p.width/2,p.y+p.height/2,0),m=this.flyingStampNode.parent.getComponent(y),h=m.convertToNodeSpaceAR(c),d=p.width/this.flyingStampNode.getComponent(y).width,D=p.height/this.flyingStampNode.getComponent(y).height,I=new g(d,D,1),this.flyingStampNode.active=!0,this.flyingStampNode.setScale(new g(3,3,1)),this.flyingStampNode.setPosition(new g(0,0,0)),f(this.flyingStampNode).to(1,{position:h,scale:I},{easing:"backOut"}).call((function(){v.updateSignInUI()})).delay(1).call((function(){var e=b(v.rewardPopupPrefab);e.getComponent(w).showRewards(u),v.node.getComponent(y).node.parent.addChild(e)})).start();case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.getIconSpriteFrame=function(e){switch(e){case"normalFeed":return this.normalFeedSpriteFrame;case"premiumFeed":return this.premiumFeedSpriteFrame;case"fan":return this.fanSpriteFrame;case"heater":return this.heaterSpriteFrame;case"brush":return this.brushSpriteFrame;default:return this.defaultSpriteFrame}},t}(d)).prototype,"daysGrid",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(G.prototype,"monthlyCountLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(G.prototype,"claimButton",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(G.prototype,"signInHintLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(G.prototype,"rewardPopupPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(G.prototype,"flyingStampNode",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(G.prototype,"normalFeedSpriteFrame",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(G.prototype,"premiumFeedSpriteFrame",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(G.prototype,"fanSpriteFrame",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(G.prototype,"heaterSpriteFrame",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(G.prototype,"brushSpriteFrame",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(G.prototype,"defaultSpriteFrame",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=G))||T));l._RF.pop()}}}));

System.register("chunks:///_virtual/QuizData.ts",["cc"],(function(n){var e;return{setters:[function(n){e=n.cclegacy}],execute:function(){e._RF.push({},"95eccu4GlZFCYdCTI3L8OmB","QuizData",void 0);n("quizQuestions",[{question:"以下在地球上存在時間最久的是?",options:["鱘龍魚","鴨嘴獸","水杉"],answerIndex:0},{question:"鱘龍魚須要養多久算是成魚?",options:["800天以上","100以上","一年以上"],answerIndex:0},{question:"鱘龍魚的 Omega-3 脂肪酸含量大約是其他常見淡水魚類的幾倍?",options:["4-5倍","差不多","8倍以上"],answerIndex:0},{question:"最大的鱘龍魚體長可達?",options:["七公尺","三公尺","五公尺"],answerIndex:0},{question:"鱘龍魚的中骨脊髓中，天然富含下列哪一種營養素?",options:["膠原蛋白","鈣質","維生素C"],answerIndex:0},{question:"目前已知世界上有幾種鱘龍魚?",options:["28種","10種","18種"],answerIndex:0},{question:"目前歷史記錄中，鱘龍魚最長壽可達幾歲？",options:["超過100歲","40歲","70歲"],answerIndex:0},{question:"目前歷史紀錄中，最重的鱘龍魚體重可達?",options:["1500公斤","500公斤","1000公斤"],answerIndex:0},{question:"鱘龍魚的鼻孔主要用來?",options:["感知嗅覺訊號","呼吸","排水"],answerIndex:0},{question:"下列哪個國家是西伯利亞鱘最大的人工養殖輸出國?",options:["中國","俄羅斯","伊朗"],answerIndex:0},{question:"下列哪種烹調方式可保留最多 Omega-3?",options:["清蒸","高溫油炸","低溫烘烤"],answerIndex:0},{question:"哪一種鱘龍魚的魚子醬被譽為全球最昂貴?",options:["白鱘（Beluga）","西伯利亞鱘","中華鱘"],answerIndex:0},{question:"西伯利亞鱘主要棲息在哪類型水域?",options:["淡水河流","高鹽度海洋","淡鹹交界的紅樹林"],answerIndex:0},{question:"大多數鱘龍魚屬於什麼生活型態?",options:["溯河洄游魚","定居魚","潮間帶短暫魚"],answerIndex:0},{question:"下列哪個因素對鱘龍魚族群數量影響最大?",options:["水壩阻斷洄游通道","氣溫升高3度","捕食者變多"],answerIndex:0},{question:"鱘龍魚喜歡什麼樣的底層環境?",options:["沙質或泥質河床","珊瑚礁群落","龍舌蘭水草繁茂區"],answerIndex:0},{question:"在人工養殖條件下，西伯利亞鱘最適水溫範圍為?",options:["15～20°C ","5～10°C","25～30°C"],answerIndex:0},{question:"鱘龍魚在野外多在哪些洲出現?",options:["歐亞與北美","亞洲與非洲","南美與澳洲"],answerIndex:0}]);e._RF.pop()}}}));

System.register("chunks:///_virtual/QuizPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./utils.ts"],(function(e){var n,t,o,r,i,c,a,s,l,u,p,f,d,h,v,b;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,c=e._decorator,a=e.Label,s=e.Button,l=e.SpriteFrame,u=e.Sprite,p=e.Color,f=e.tween,d=e.Vec3,h=e.Node,v=e.Component},function(e){b=e.shuffleArray}],execute:function(){var w,m,g,y,E,C,S,I,z,F,A;i._RF.push({},"7c2cdvU+QlDcIa5MfAPFQc5","QuizPanel",void 0);var B=c.ccclass,L=c.property;e("QuizPanel",(w=B("QuizPanel"),m=L(a),g=L([s]),y=L(l),E=L(l),w((I=n((S=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return n=e.call.apply(e,[this].concat(i))||this,o(n,"questionLabel",I,r(n)),o(n,"optionButtons",z,r(n)),o(n,"correctIconSpriteFrame",F,r(n)),o(n,"wrongIconSpriteFrame",A,r(n)),n.resolveAnswer=void 0,n.correctIndex=0,n.isCorrect=!1,n}t(n,e);var i=n.prototype;return i.setup=function(e){var n=this;this.questionLabel.string=e.question;var t=b([].concat(e.options.slice(0,3)));this.correctIndex=t.indexOf(e.options[e.answerIndex]);for(var o=["A. ","B. ","C. "],r=function(e){var r=n.optionButtons[e],i=r.getComponentInChildren(a);e<3?(r.node.active=!0,i.string=o[e]+t[e],r.interactable=!0,r.node.off(h.EventType.MOUSE_ENTER),r.node.off(h.EventType.MOUSE_LEAVE),r.node.off("click"),r.node.on(h.EventType.MOUSE_ENTER,(function(){r.interactable&&(r.node.getComponent(u).color=new p(213,239,255))})),r.node.on(h.EventType.MOUSE_LEAVE,(function(){r.interactable&&(r.node.getComponent(u).color=new p(226,244,255))})),r.node.once("click",(function(){return n.onSelect(e)}))):r.node.active=!1},i=0;i<this.optionButtons.length;i++)r(i);return new Promise((function(e){n.resolveAnswer=e}))},i.onSelect=function(e){var n=this;this.isCorrect=e===this.correctIndex;var t=this.optionButtons[e];if(t.node.getComponent(u).color=this.isCorrect?new p(102,204,154):new p(255,50,51),this.isCorrect)f(t.node).to(.1,{scale:new d(1.05,1.05,1)}).to(.1,{scale:new d(1,1,1)}).start();else{for(var o=t.node.position.clone(),r=f(t.node),i=0;i<3;i++)r=r.to(.05,{position:new d(o.x+(i%2==0?10:-10),o.y,o.z)}).to(.05,{position:o});r.start()}var c=t.getComponentsInChildren(u).find((function(e){return e.node!==t.node}));c&&(c.spriteFrame=this.isCorrect?this.correctIconSpriteFrame:this.wrongIconSpriteFrame,c.node.active=!0),this.optionButtons.forEach((function(e){return e.interactable=!1})),this.scheduleOnce((function(){n.resolveAnswer(n.isCorrect),n.node.destroy()}),1.5)},n}(v)).prototype,"questionLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(S.prototype,"optionButtons",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=n(S.prototype,"correctIconSpriteFrame",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(S.prototype,"wrongIconSpriteFrame",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=S))||C));i._RF.pop()}}}));

System.register("chunks:///_virtual/RenamePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,i,r,a,o,l,s,c;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,s=e.EditBox,c=e.Component}],execute:function(){var u,p,f,h,m,d,g;a._RF.push({},"a1028v47H5K07nzlDR15RQK","RenamePanel",void 0);var y=o.ccclass,v=o.property;e("RenamePanel",(u=y("RenamePanel"),p=v(l),f=v(s),u((d=n((m=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return n=e.call.apply(e,[this].concat(a))||this,i(n,"panel",d,r(n)),i(n,"input",g,r(n)),n.fishId=-1,n}t(n,e);var a=n.prototype;return a.show=function(e){e&&(this.fishId=e.id,this.input.string=e.name,this.panel.active=!0)},a.hide=function(){this.panel.active=!1},a.renameFish=function(e,n){return!(!n||n.length>12)&&(e.name=n,!0)},a.confirmRename=function(){var e=this,n=this.input.string.trim();if(n){var t=JSON.parse(localStorage.getItem("playerData")),i=t.fishList.find((function(n){return n.id===e.fishId}));if(i)this.renameFish(i,n)?(localStorage.setItem("playerData",JSON.stringify(t)),this.hide()):console.warn("名字無效")}else console.warn("名字不能為空！")},n}(c)).prototype,"panel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=n(m.prototype,"input",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=m))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/RewardItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,n,a,l,o,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,l=e._decorator,o=e.Sprite,c=e.Label,u=e.Component}],execute:function(){var p,s,b,m,f,y,d,g,h;a._RF.push({},"5933cdguJ5I4LXe+Iv+wspf","RewardItem",void 0);var L=l.ccclass,w=l.property;e("RewardItem",(p=L("RewardItem"),s=w(o),b=w(c),m=w(c),p((d=t((y=function(e){function t(){for(var t,r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return t=e.call.apply(e,[this].concat(a))||this,i(t,"itemSprite",d,n(t)),i(t,"nameLabel",g,n(t)),i(t,"countLabel",h,n(t)),t}return r(t,e),t.prototype.init=function(e,t,r){this.itemSprite.spriteFrame=e,this.nameLabel.string=t,this.countLabel.string="x"+r},t}(u)).prototype,"itemSprite",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=t(y.prototype,"nameLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=t(y.prototype,"countLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=y))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/RewardPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RewardItem.ts"],(function(e){var t,r,i,a,n,o,c,l,f,u,s,p,d,h,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.createForOfIteratorHelperLoose,a=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,l=e.Node,f=e.Prefab,u=e.instantiate,s=e.Vec3,p=e.UIOpacity,d=e.tween,h=e.Component},function(e){g=e.RewardItem}],execute:function(){var b,w,y,m,C,R,L,v,P,I,W,z,E;o._RF.push({},"bfdf9YEfL9KSqEJa2k66Zxa","RewardPopup",void 0);var F=c.ccclass,A=c.property;e("RewardPopup",(b=F("RewardPopup"),w=A(l),y=A(f),m=A(l),C=A(l),R=A(l),b((P=t((v=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,a(t,"rewardGrid",P,n(t)),a(t,"rewardItemPrefab",I,n(t)),a(t,"effectLightBase",W,n(t)),a(t,"effectLightRotateCW",z,n(t)),a(t,"effectLightRotateCCW",E,n(t)),t}r(t,e);var o=t.prototype;return o.showRewards=function(e){this.rewardGrid.removeAllChildren();for(var t,r=i(e);!(t=r()).done;){var a=t.value,n=u(this.rewardItemPrefab);n.getComponent(g).init(a.icon,a.name,a.count),this.rewardGrid.addChild(n)}this.playEnterAnimation(),this.playEffectLight()},o.playEnterAnimation=function(){this.node.scale=new s(.5,.5,1);var e=this.node.getComponent(p);e&&(e.opacity=0,d(e).to(.6,{opacity:255},{easing:"quadOut"}).start()),d(this.node).to(.6,{scale:new s(1,1,1)},{easing:"backOut"}).start()},o.playEffectLight=function(){this.effectLightRotateCW&&d(this.effectLightRotateCW).by(5,{angle:360}).repeatForever().start(),this.effectLightRotateCCW&&d(this.effectLightRotateCCW).by(5,{angle:-360}).repeatForever().start()},o.onConfirm=function(){this.node.destroy()},t}(h)).prototype,"rewardGrid",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(v.prototype,"rewardItemPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(v.prototype,"effectLightBase",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(v.prototype,"effectLightRotateCW",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(v.prototype,"effectLightRotateCCW",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=v))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/SignInPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataManager.ts"],(function(n){var e,t,o,i,a,r,l,s,c,u,h,p,y,f;return{setters:[function(n){e=n.applyDecoratedDescriptor,t=n.inheritsLoose,o=n.initializerDefineProperty,i=n.assertThisInitialized,a=n.asyncToGenerator,r=n.regeneratorRuntime},function(n){l=n.cclegacy,s=n._decorator,c=n.Node,u=n.Button,h=n.Sprite,p=n.Color,y=n.Component},function(n){f=n.DataManager}],execute:function(){var w,v,g,d,b,m,k,P,T,S,I,B,D;l._RF.push({},"41118NYzBlDtoozrSfsrMdm","SignInPanel",void 0);var C=s.ccclass,z=s.property;n("SignInPanel",(w=C("SignInPanel"),v=z(c),g=z(c),d=z(u),b=z(u),m=z(u),w((T=e((P=function(n){function e(){for(var e,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,o(e,"weeklyPanel",T,i(e)),o(e,"monthlyPanel",S,i(e)),o(e,"weeklyTabBtn",I,i(e)),o(e,"monthlyTabBtn",B,i(e)),o(e,"closeBtn",D,i(e)),e}t(e,n);var l=e.prototype;return l.start=function(){var n=a(r().mark((function n(){var e,t,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return null==(e=this.weeklyTabBtn)||e.node.on(u.EventType.CLICK,this.showWeekly,this),null==(t=this.monthlyTabBtn)||t.node.on(u.EventType.CLICK,this.showMonthly,this),null==(o=this.closeBtn)||o.node.on(u.EventType.CLICK,this.closePanel,this),this.showWeekly(),n.next=6,this.checkIfShouldShow();case 6:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),l.checkIfShouldShow=function(){var n=a(r().mark((function n(){var e,t,o,i,a,l,s;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null==(e=f.ready)?void 0:e.catch((function(){}));case 2:return n.next=4,f.getPlayerData();case 4:if((i=n.sent)&&i.signInData){n.next=9;break}return console.warn("[簽到面板] 尚未取得玩家資料，先隱藏面板"),this.node.active=!1,n.abrupt("return");case 9:a=(new Date).toISOString().split("T")[0],l=(null==(t=i.signInData.weekly)?void 0:t.lastSignDate)===a,s=(null==(o=i.signInData.monthly)?void 0:o.lastSignDate)===a,l?s?(this.node.active=!1,console.log("[簽到面板] 週與月皆已簽到 -> 關閉面板")):(this.node.active=!0,this.showMonthly(),console.log("[簽到面板] 今日週已簽到但月未簽到 -> 自動切到月簽到")):(this.node.active=!0,this.showWeekly(),console.log("[簽到面板] 今日週尚未簽到 -> 顯示週簽到"));case 13:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),l.showWeekly=function(){this.weeklyPanel.active=!0,this.monthlyPanel.active=!1,this.updateTabVisual()},l.showMonthly=function(){this.weeklyPanel.active=!1,this.monthlyPanel.active=!0,this.updateTabVisual()},l.updateTabVisual=function(){var n=this.weeklyTabBtn.node.getComponent(h),e=this.monthlyTabBtn.node.getComponent(h);n&&e&&(n.color=this.weeklyPanel.active?new p(255,255,255):new p(180,180,180),e.color=this.monthlyPanel.active?new p(255,255,255):new p(180,180,180))},l.closePanel=function(){this.node.active=!1},l.openPanel=function(){this.node.active=!0,this.showWeekly(),console.log("[簽到面板] 手動開啟")},l.onWeeklySignInDone=function(){var n=a(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{this.showMonthly(),console.log("[簽到面板] 週簽到完成 -> 自動切換到月簽到")}catch(n){console.warn("[簽到面板] 週簽到完成後切換月簽到失敗：",n)}case 1:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),e}(y)).prototype,"weeklyPanel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(P.prototype,"monthlyPanel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"weeklyTabBtn",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(P.prototype,"monthlyTabBtn",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(P.prototype,"closeBtn",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=P))||k));l._RF.pop()}}}));

System.register("chunks:///_virtual/SwimmingFish.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FishDetailManager.ts","./DataManager.ts"],(function(t){var e,i,n,o,r,s,a,l,u,h,c,m,p,d;return{setters:[function(t){e=t.inheritsLoose,i=t.asyncToGenerator,n=t.regeneratorRuntime},function(t){o=t.cclegacy,r=t._decorator,s=t.UITransform,a=t.Vec3,l=t.Sprite,u=t.Node,h=t.Component,c=t.tween,m=t.find},function(t){p=t.FishDetailManager},function(t){d=t.DataManager}],execute:function(){var f,g;o._RF.push({},"ff87csflAtIoZduCCeP/Ybx","SwimmingFish",void 0);var v=r.ccclass;r.property,t("SwimmingFish",v("SwimmingFish")(((g=function(t){function o(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).fishData=null,e.isMovingRight=!1,e.speed=80,e.fishAreaWorldLeft=0,e.fishAreaWorldRight=0,e.emotionBubble=null,e.emotionSprite=null,e._lastEmotion=null,e._lastEmotionSprite=null,e}e(o,t),o.setEmotionFrames=function(t){this._emotionFrames=t||{}},o.getEmotionSpriteByKey=function(t){var e,i;return null!=(e=null!=(i=this._emotionFrames[t])?i:this._emotionFrames.happy)?e:null};var r=o.prototype;return r.start=function(){var t,e,i,n=this.node.parent,o=n.getComponent(s),r=n.getWorldPosition(),h=o.width/2;this.fishAreaWorldLeft=r.x-h+50,this.fishAreaWorldRight=r.x+h-50;var c=this.node.initialDirection;this.isMovingRight=1===c,this.node.setScale(this.isMovingRight?new a(-1,1,1):new a(1,1,1)),this.emotionBubble=this.node.getChildByName("EmotionBubble");var m=null==(t=this.emotionBubble)?void 0:t.getChildByName("EmotionIcon");this.emotionSprite=(null==m||null==(e=m.getChildByName("Sprite"))?void 0:e.getComponent(l))||null,this.emotionSprite||console.warn("[SwimmingFish] 找不到 EmotionBubble 內的 Sprite，請確認泡泡底下有 Sprite 元件");var p=null==(i=this.emotionBubble)?void 0:i.getChildByName("MagnifierBtn");null==p||p.on(u.EventType.TOUCH_END,this.onClickMagnifier,this),this.node.on(u.EventType.TOUCH_END,this.onClickFish,this)},r.update=function(t){var e,i;if(this!==o.currentSelectedFish&&null!=(e=this.emotionBubble)&&e.active&&(this.emotionBubble.active=!1),null==(i=this.emotionBubble)||!i.active){var n=this.speed*t*(this.isMovingRight?1:-1),r=this.node.position.x+n;this.node.setPosition(r,this.node.position.y,0);var s=this.node.getWorldPosition().x;s>this.fishAreaWorldRight&&this.isMovingRight?(this.isMovingRight=!1,this.node.setScale(new a(1,1,1))):s<this.fishAreaWorldLeft&&!this.isMovingRight&&(this.isMovingRight=!0,this.node.setScale(new a(-1,1,1)))}},r.setFishData=function(t){this.fishData=t},r.onClickFish=function(){var t=i(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.emotionBubble){t.next=2;break}return t.abrupt("return");case 2:if(o.currentSelectedFish!==this){t.next=6;break}return this.emotionBubble.active=!1,o.currentSelectedFish=null,t.abrupt("return");case 6:return o.currentSelectedFish&&(o.currentSelectedFish.emotionBubble.active=!1),o.currentSelectedFish=this,this.emotionBubble.active=!0,this.emotionBubble.setScale(new a(.3,.3,1)),t.next=12,this.updateBubbleEmotionIcon();case 12:c(this.emotionBubble).to(.25,{scale:new a(1,1,1)},{easing:"backOut"}).start();case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o.clearSelection=function(){if(o.currentSelectedFish){var t=o.currentSelectedFish.emotionBubble;t&&t.isValid&&(t.active=!1),o.currentSelectedFish=null}},r.onClickMagnifier=function(){var t=i(n().mark((function t(){var e,i,o,r,s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.getPlayerDataCached();case 2:if(i=t.sent,o=parseInt(this.node.name.split("_")[1]),r=i.fishList.find((function(t){return t.id===o})),s=null==(e=m("/GameManager"))?void 0:e.getComponent(p),this._lastEmotionSprite){t.next=9;break}return t.next=9,this.updateBubbleEmotionIcon();case 9:s.showFishDetail(r,this._lastEmotionSprite||null);case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.updateBubbleEmotionIcon=function(){var t=i(n().mark((function t(){var e,i,r,s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.emotionSprite){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,d.getPlayerDataCached();case 4:e=t.sent,i=null==e?void 0:e.tankEnvironment,r=o.computeEmotion(this.fishData,i),(s=o.getEmotionSpriteByKey(r))&&(this.emotionSprite.spriteFrame=s,this._lastEmotion=r,this._lastEmotionSprite=s);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o.computeEmotion=function(t,e){var i,n;if(null!=(i=t.status)&&i.sick)return"sick";if((null==e?void 0:e.temperature)<18)return"cold";if((null==e?void 0:e.temperature)>23)return"hot";if((null!=(n=t.hunger)?n:0)>=80)return"hungry";var o=["happy","sad","angry"];return o[Math.floor(Math.random()*o.length)]},o}(h)).currentSelectedFish=null,g._emotionFrames={},f=g))||f);o._RF.pop()}}}));

System.register("chunks:///_virtual/TankEnvironmentManager.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"fc7c8V4VSlJdJjnDRnHVYya","TankEnvironmentManager",void 0);e("TankEnvironmentManager",function(){function e(){}return e.adjustTemperature=function(e){var t=e.tankEnvironment;t.temperature=21,t.isTemperatureDanger=!1,t.lastTempUpdateTime=(new Date).toISOString(),console.log("水溫已調整為 21°C（正常範圍）")},e.cleanWater=function(e){var t=e.tankEnvironment;t.waterQualityStatus="clean",t.lastCleanTime=(new Date).toISOString(),t.loginDaysSinceClean=0,console.log("魚缸已清理，狀態變為乾淨")},e.shouldUpdateTemperature=function(e){var t=e.tankEnvironment,n=new Date(t.lastTempUpdateTime||new Date);return((new Date).getTime()-n.getTime())/36e5>=12},e.updateTemperature=function(e){var t=e.tankEnvironment,n=4*Math.random()-2;t.temperature=Math.round(10*(t.temperature+n))/10,t.lastTempUpdateTime=(new Date).toISOString(),t.isTemperatureDanger=t.temperature<18||t.temperature>23,console.log("水溫更新為 "+t.temperature+"°C，是否異常："+t.isTemperatureDanger)},e.checkWaterDirty=function(e){var t,n=e.tankEnvironment;(null!=(t=n.loginDaysSinceClean)?t:0)>=2&&(n.waterQualityStatus="dirty",console.log("魚缸已變髒！（以登入日累積達 2 天）"))},e.isEnvBad=function(e){var t=e.tankEnvironment;return t.isTemperatureDanger||"dirty"===t.waterQualityStatus},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/TombManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataManager.ts"],(function(e){var t,n,i,r,a,o,l,s,u,c,f,b,h,p,g,m,d,v,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime,l=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,u=e._decorator,c=e.Node,f=e.Prefab,b=e.Label,h=e.UIOpacity,p=e.tween,g=e.Vec3,m=e.Component,d=e.instantiate,v=e.Button},function(e){y=e.DataManager}],execute:function(){var D,w,L,C,T,x,P,F,k,z,B,E,N,O,_,H,U,I,M,Y,R,A,V,j,q,G,S,J,K,Q,W,X,Z,$,ee,te,ne,ie,re;s._RF.push({},"ed3f6FtoxFFlLalg/eFzCms","TombManager",void 0);var ae=u.ccclass,oe=u.property;e("TombManager",(D=ae("TombManager"),w=oe(c),L=oe(f),C=oe(c),T=oe(b),x=oe(b),P=oe(b),F=oe(b),k=oe(b),z=oe(b),B=oe(c),E=oe(c),N=oe(b),O=oe(c),_=oe(c),H=oe(c),U=oe(b),I=oe(c),M=oe(c),D((A=t((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"tombContainer",A,r(t)),i(t,"tombstonePrefab",V,r(t)),i(t,"deadFishDetailPanel",j,r(t)),i(t,"titleLabel",q,r(t)),i(t,"nameLabel",G,r(t)),i(t,"genderLabel",S,r(t)),i(t,"daysLabel",J,r(t)),i(t,"stageLabel",K,r(t)),i(t,"deathDateLabel",Q,r(t)),i(t,"floatingNode",W,r(t)),i(t,"reviveBtn",X,r(t)),i(t,"reviveCountLabel",Z,r(t)),i(t,"resetBtn",$,r(t)),i(t,"closeBtn",ee,r(t)),i(t,"confirmDialogPanel",te,r(t)),i(t,"confirmDialogText",ne,r(t)),i(t,"confirmDialogYesButton",ie,r(t)),i(t,"confirmDialogNoButton",re,r(t)),t.deadFishList=[],t.confirmCallback=null,t}n(t,e);var s=t.prototype;return s.init=function(){var e=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getPlayerData();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:this.deadFishList=t.fishList.filter((function(e){return e.isDead})),this.refreshTombs();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.start=function(){var e=this;this.confirmDialogYesButton.on(c.EventType.TOUCH_END,(function(){e.confirmCallback&&(e.confirmCallback(),e.confirmCallback=null),e.confirmDialogPanel.active=!1})),this.confirmDialogNoButton.on(c.EventType.TOUCH_END,(function(){e.confirmCallback=null,e.confirmDialogPanel.active=!1}))},s.refreshTombs=function(){var e=a(o().mark((function e(){var t,n,i,r,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getPlayerData();case 2:if(t=e.sent,this.deadFishList=t.fishList.filter((function(e){return e.isDead})),this.tombContainer.removeAllChildren(),0!==this.deadFishList.length){e.next=7;break}return e.abrupt("return");case 7:n=o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.value,(n=d(a.tombstonePrefab)).getComponentInChildren(b).string=t.name,n.on(c.EventType.TOUCH_END,(function(){a.showDeadFishDetail(t)})),a.tombContainer.addChild(n);case 5:case"end":return e.stop()}}),e)})),i=l(this.deadFishList);case 9:if((r=i()).done){e.next=13;break}return e.delegateYield(n(),"t0",11);case 11:e.next=9;break;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.showDeadFishDetail=function(){var e=a(o().mark((function e(t){var n,i,r,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deadFishDetailPanel.active=!0,e.next=3,y.getPlayerData();case 3:i=e.sent,r=i.inventory.items.revivePotion,this.reviveCountLabel.string=""+r,this.reviveBtn.getComponent(v).interactable=r>0,this.titleLabel.string=t.name+" 的魚生回憶",this.nameLabel.string="名字："+t.name,this.genderLabel.string="性別："+("male"===t.gender?"公魚":"母魚"),this.daysLabel.string="成長天數：牠努力生活了 "+t.growthDaysPassed+" 天",this.stageLabel.string="階段：LV "+t.stage,this.deathDateLabel.string="離開的日子：在 "+(null!=(n=t.deathDate)?n:"未知")+"，牠悄悄地離開了魚缸",this.reviveBtn.off(c.EventType.TOUCH_END),this.resetBtn.off(c.EventType.TOUCH_END),this.closeBtn.off(c.EventType.TOUCH_END),r>0&&this.reviveBtn.on(c.EventType.TOUCH_END,(function(){a.showConfirmDialog("確定要復活 "+t.name+" 嗎？",(function(){return a.reviveFish(t)}))})),this.resetBtn.on(c.EventType.TOUCH_END,(function(){a.showConfirmDialog("確定要讓 "+t.name+" 重新開始嗎？",(function(){return a.resetFish(t)}))})),this.closeBtn.on(c.EventType.TOUCH_END,(function(){a.deadFishDetailPanel.active=!1}));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.reviveFish=function(){var e=a(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getPlayerData();case 2:if(!((n=e.sent).inventory.items.revivePotion<=0)){e.next=6;break}return console.warn("沒有復活藥"),e.abrupt("return");case 6:if(-1!==(i=n.fishList.findIndex((function(e){return e.id===t.id})))){e.next=9;break}return e.abrupt("return");case 9:return n.inventory.items.revivePotion--,n.fishList[i].isDead=!1,n.fishList[i].emotion="happy",n.fishList[i].hunger=50,e.next=15,y.savePlayerData(n);case 15:console.log(t.name+" 已復活"),this.showFloatingTextCenter(t.name+" 已復活，快去 "+t.tankId+" 號魚缸看看牠吧！"),this.deadFishDetailPanel.active=!1,this.refreshTombs();case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.resetFish=function(){var e=a(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getPlayerData();case 2:if(n=e.sent,-1!==(i=n.fishList.findIndex((function(e){return e.id===t.id})))){e.next=6;break}return e.abrupt("return");case 6:return n.fishList[i].isDead=!1,n.fishList[i].emotion="happy",n.fishList[i].stage=1,n.fishList[i].growthDaysPassed=0,n.fishList[i].hunger=50,e.next=13,y.savePlayerData(n);case 13:console.log(t.name+" 已重新開始養殖"),this.showFloatingTextCenter(t.name+" 已重新開始，快去 "+t.tankId+" 號魚缸看看牠吧！"),this.deadFishDetailPanel.active=!1,this.refreshTombs();case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.showConfirmDialog=function(e,t){this.confirmDialogText.string=e,this.confirmDialogPanel.active=!0,this.confirmCallback=t},s.showFloatingTextCenter=function(e){var t=this.floatingNode,n=t.getComponentInChildren(b),i=t.getComponent(h);if(n&&i){p(t).stop(),p(i).stop(),n.string=e,t.active=!0,i.opacity=0;var r=new g(0,0,0),a=new g(0,30,0);t.setPosition(r),p(i).to(.3,{opacity:255}).delay(2.5).to(.4,{opacity:0}).call((function(){return t.active=!1})).start(),p(t).to(1.5,{position:a},{easing:"quadOut"}).start()}else console.warn("floatingNode 缺少 Label 或 UIOpacity 元件")},t}(m)).prototype,"tombContainer",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(R.prototype,"tombstonePrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(R.prototype,"deadFishDetailPanel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(R.prototype,"titleLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(R.prototype,"nameLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(R.prototype,"genderLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(R.prototype,"daysLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(R.prototype,"stageLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(R.prototype,"deathDateLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(R.prototype,"floatingNode",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(R.prototype,"reviveBtn",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(R.prototype,"reviveCountLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(R.prototype,"resetBtn",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(R.prototype,"closeBtn",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(R.prototype,"confirmDialogPanel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(R.prototype,"confirmDialogText",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=t(R.prototype,"confirmDialogYesButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=t(R.prototype,"confirmDialogNoButton",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=R))||Y));s._RF.pop()}}}));

System.register("chunks:///_virtual/utils.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){t({getOrCreateUserId:function(){var t=localStorage.getItem("userId");if(t)return t;var e="TEMP_"+Math.random().toString(36).substring(2,10);return localStorage.setItem("userId",e),e},getRandomItem:function(t){return t[Math.floor(Math.random()*t.length)]},getTodayIndex:function(){return((new Date).getDay()+6)%7},getWeekStartKey:function(t,e){void 0===t&&(t=new Date);void 0===e&&(e=480);var r=new Date(t.getTime()+6e4*e),n=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())),a=(n.getUTCDay()+6)%7;return n.setUTCDate(n.getUTCDate()-a),n.toISOString().slice(0,10)},shuffleArray:function(t){for(var e=[].concat(t),r=e.length-1;r>0;r--){var n=Math.floor(Math.random()*(r+1)),a=[e[n],e[r]];e[r]=a[0],e[n]=a[1]}return e}}),e._RF.push({},"2d2fbgjcXBLH5Tr8Xztdvcm","utils",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/WeeklySignInManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataManager.ts","./RewardPopup.ts","./QuizPanel.ts","./SignInPanel.ts","./utils.ts"],(function(e){var t,n,a,r,i,o,s,l,u,c,p,g,d,y,f,h,b,m,S,I,w,D,k,P;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,u=e.Sprite,c=e.Label,p=e.Button,g=e.Prefab,d=e.SpriteFrame,y=e.Color,f=e.Component,h=e.instantiate,b=e.UITransform},function(e){m=e.DataManager},function(e){S=e.RewardPopup},function(e){I=e.QuizPanel},function(e){w=e.SignInPanel},function(e){D=e.getTodayIndex,k=e.getWeekStartKey,P=e.getRandomItem}],execute:function(){var v,F,x,z,B,C,M,T,L,R,W,_,H,K,q,Q,U,O,j,A,G,V,E;s._RF.push({},"4236cmKkvVCsocbSypDKfTI","WeeklySignInManager",void 0);var J=l.ccclass,N=l.property,X=function(e){return e[e.Missed=0]="Missed",e[e.Today=1]="Today",e[e.Future=2]="Future",e[e.Signed=3]="Signed",e}(X||{});e("WeeklySignInManager",(v=J("WeeklySignInManager"),F=N(w),x=N(u),z=N(c),B=N(p),C=N(c),M=N(g),T=N(g),L=N(d),R=N(d),W=N(d),v((K=t((H=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,a(t,"signInPanel",K,r(t)),a(t,"dayBgSprites",q,r(t)),a(t,"dayLabels",Q,r(t)),a(t,"claimButton",U,r(t)),a(t,"signInHintLabel",O,r(t)),a(t,"rewardPopupPrefab",j,r(t)),a(t,"quizPanelPrefab",A,r(t)),a(t,"dragonBoneSpriteFrame",G,r(t)),a(t,"premiumFeedSpriteFrame",V,r(t)),a(t,"defaultSpriteFrame",E,r(t)),t.todayIndex=0,t.playerData=void 0,t}n(t,e);var s=t.prototype;return s.start=function(){var e=i(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=m.ready)?void 0:t.catch((function(){}));case 2:return e.next=4,m.getPlayerData();case 4:if(this.playerData=e.sent,this.playerData&&this.playerData.signInData){e.next=8;break}return console.warn("[WeeklySignIn] 尚未取得玩家資料，停用本元件初始化"),e.abrupt("return");case 8:this.handleWeekReset(),this.todayIndex=D(),this.updateSignInUI(),this.claimButton.node.on("click",this.onClaimButtonClick,this),n=(new Date).toISOString().split("T")[0],this.playerData.signInData.weekly.lastSignDate===n?(this.claimButton.interactable=!1,this.signInHintLabel.string="今日已簽到"):(this.claimButton.interactable=!0,this.signInHintLabel.string="答題簽到");case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.handleWeekReset=function(){var e=i(o().mark((function e(){var t,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k(),n=this.playerData.signInData.weekly||{},a=n.weekKey,console.log("本週週鍵 =",t),console.log("玩家資料週鍵 =",a),a===t){e.next=10;break}return console.log("新的一週開始，重置週簽到資料"),this.playerData.signInData.weekly={weekKey:t,daysSigned:[!1,!1,!1,!1,!1,!1,!1],questionsCorrect:[!1,!1,!1,!1,!1,!1,!1],lastSignDate:""},e.next=10,m.savePlayerData(this.playerData);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.updateSignInUI=function(){for(var e=0;e<this.dayBgSprites.length;e++){var t=this.dayBgSprites[e],n=this.dayLabels[e],a=void 0;a=this.playerData.signInData.weekly.daysSigned[e]?X.Signed:e===this.todayIndex?X.Today:e<this.todayIndex?X.Missed:X.Future,this.applyStyle(t,n,a)}},s.applyStyle=function(e,t,n){switch(n){case X.Signed:e.color=new y(180,255,180),t.string="✔ 已簽";break;case X.Today:e.color=new y(255,241,150),t.string="今天";break;case X.Missed:e.color=new y(255,143,143),t.string="未簽";break;case X.Future:e.color=new y(224,221,222),t.string="未來"}},s.getIconSpriteFrame=function(e){switch(e){case"dragonbone":return this.dragonBoneSpriteFrame;case"premium_feed":return this.premiumFeedSpriteFrame;default:return this.defaultSpriteFrame}},s.onClaimButtonClick=function(){var e=i(o().mark((function e(){var t,n,a,r,i,s,l,u,c,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(new Date).toISOString().split("T")[0],this.playerData.signInData.weekly.lastSignDate!==n){e.next=5;break}return console.log("今天已簽到"),e.abrupt("return");case 5:return e.next=7,m.getQuizQuestions();case 7:return a=e.sent,r=P(a),i=h(this.quizPanelPrefab),this.node.parent.addChild(i),s=i.getComponent(I),e.next=14,s.setup(r);case 14:return l=e.sent,this.playerData.signInData.weekly.lastSignDate=n,this.playerData.signInData.weekly.daysSigned[this.todayIndex]=!0,10,u=l?20:10,this.playerData.dragonBones+=u,6===this.todayIndex&&(this.playerData.inventory.feeds.premium+=1,console.log("今日為第七天，發送一包高級飼料！")),c=[{icon:this.getIconSpriteFrame("dragonbone"),name:"龍骨",count:u}],6===this.todayIndex&&c.push({icon:this.getIconSpriteFrame("premium_feed"),name:"高級飼料",count:1}),(p=h(this.rewardPopupPrefab)).getComponent(S).showRewards(c),this.node.getComponent(b).node.parent.addChild(p),e.next=28,m.savePlayerData(this.playerData);case 28:this.updateSignInUI(),this.claimButton.interactable=!1,null==(t=this.signInPanel)||t.onWeeklySignInDone();case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(f)).prototype,"signInPanel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(H.prototype,"dayBgSprites",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=t(H.prototype,"dayLabels",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=t(H.prototype,"claimButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(H.prototype,"signInHintLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(H.prototype,"rewardPopupPrefab",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(H.prototype,"quizPanelPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(H.prototype,"dragonBoneSpriteFrame",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(H.prototype,"premiumFeedSpriteFrame",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(H.prototype,"defaultSpriteFrame",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=H))||_));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});